<html>
<head>
  <title>UnitTest</title>
</head>
<body>
  <script src="./UnitTest.js"></script>
  <script>

    "use strict";

    var httpAPI = [{"command":"Default Search", "url":"/DNIAPI?command=Search&searchMethod=0&interfaceMAC=00:18:23:AB:CD:EF&interfaceIP=192.168.1.1"},
      {"command":"Range Search", "url":"/DNIAPI?command=Search&searchMethod=1&includeStartAddr=192.168.1.1&includeEndAddr=192.168.1.20"},
      {"command":"Exclude Search", "url":"/DNIAPI?command=Search&searchMethod=2&includeStartAddr=192.168.1.1&includeEndAddr=192.168.1.20&excludeStartAddr=192.168.1.10&excludeEndAddr=192.168.1.15"},
      {"command":"Subnet Search", "url":"/DNIAPI?command=Search&searchMethod=3&interfaceMAC=00:18:23:AB:CD:EF&interfaceIP=192.168.1.1&subnetMask=255.255.255.0"},
      {"command":"Backup Device Configuration", "url":"/DNIAPI?command=BackupConfig&deviceIndex=1"},
      {"command":"Restore Device Configuration", "url":"/DNIAPI?command=RestoreConfig&deviceIndex=2&modelName=DVS-110W02-3SFP&deviceMAC=00:18:23:01:32:8d&fileName=092601_0108_2016"},
      {"command":"Get Configuration Archive", "url":"/DNIAPI?command=GetConfigArchive"},
      {"command":"Upgrade Device Firmware", "url":"/DNIAPI?command=UpgradeFirmware&deviceIndex=2&modelName=DVS-110W02-3SFP&fileName=1.08"},
      {"command":"Get Firmware Archive", "url":"/DNIAPI?command=GetFirmwareArchive"},
      {"command":"Get Topology Information", "url":"/DNIAPI?command=GetTopologyInfo"},
      {"command":"Get Port Information", "url":"/DNIAPI?command=GetPortData&deviceIndex=1"},
      {"command":"Get Server Configuration", "url":"/DNIAPI?command=GetServerConfig"},
      {"command":"Get Account List", "url":"/DNIAPI?command=GetAccountList"},
      {"command":"Set Account", "url":"/DNIAPI?command=SetAccount&account=new&password=96e79218965eb72c92a549dd5a330112"},
      {"command":"Delete Account", "url":"/DNIAPI?command=DeleteAccount&deleteAccount=oldAccount"},
      {"command":"Set Device Coordinate", "url":"/DNIAPI?command=SetDeviceCoordinate&deviceCoordinate={¡§device¡¨:[{¡§mac¡¨:¡¨AA:BB:CC:DD:EE:FF¡¨,¡¨x¡¨:10,¡¨y¡¨:20,¡¨w¡¨:100,¡¨h¡¨:200}]}"},
      {"command":"Set Detection", "url":"/DNIAPI?command=SetDetection&auto_rescan=true&auto_rescan_time=24&detect_interval=24&retries=10&display_link_lost_device=true&keep_time=10"},
      {"command":"Set Schedule Backup", "url":"/DNIAPI?command=SetScheduleBackup&enable=1&mac=00:18:23:01:32:8d&date=1452762014882&interval=1&backup_times=3"},
      {"command":"Get Schedule Backup", "url":"/DNIAPI?command=GetScheduleBackup"},
      {"command":"Set SNMP Community", "url":"/DNIAPI?command=SetSNMPCommunity&snmp_read_community=public&snmp_write_community=private"},
      {"command":"Get SNMP Community", "url":"/DNIAPI?command=GetSNMPCommunity"},
      {"command":"Set Trap Community", "url":"/DNIAPI?command=SetTrapCommunity&trap_community=public"},
      {"command":"Get Trap Community", "url":"/DNIAPI?command=GetTrapCommunity"},
      {"command":"Set Trap Receiver", "url":"/DNIAPI?command=SetTrapReceiver&trap_receiver=true"},
      {"command":"Get Utilization Level", "url":"/DNIAPI?command=GetUtilizationLevel"},
      {"command":"Get Uptime", "url":"/DNIAPI?command=GetUptime&deviceIndex=1"},
      {"command":"Query Event Log", "url":"/DNIAPI?command=QueryEventLog&startTime=1461232950901&endTime=1461291867800"},
      {"command":"Query Last Event Log", "url":"/DNIAPI?command=QueryLastEventLog&eventCounter=64"},
      {"command":"Set Event Log Retention", "url":"/DNIAPI?command=SetLogRetention&retention=true&retention_day=7"},
      {"command":"Get Event Action", "url":"/DNIAPI?command=GetEventAction"},
      {"command":"Set Event Action", "url":"/DNIAPI?command=SetEventAction&name=event_action1&event_name=LinkDown&action_name=Email"},
      {"command":"Delete Event Action", "url":"/DNIAPI?command=DeleteEventAction&name=event_action1"},
      {"command":"Get Packet", "url":"/DNIAPI?command=GetPacket&deviceIndex=1&ifIndex=5"},
      {"command":"Test Mail", "url":"/DNIAPI?command=TestMail"},
      {"command":"Set SMTP", "url":"/DNIAPI?command=SetSmtpConfig&smtp_well_known=Manual&smtp_sender=xxx@hinet.net&smtp_server=msa.hinet.net&smtp_auth_enable=false&smtp_auth_user=aaa&smtp_auth_password=bbb"},
      {"command":"Get Mail List", "url":"/DNIAPI?command=GetMailList"},
      {"command":"Add Mail", "url":"/DNIAPI?command=AddMail&mail=xx@gmail.com"},
      {"command":"Delete Mail", "url":"/DNIAPI?command=DeleteMail&mail=xx@gmail.com"},
      {"command":"Set Log Server", "url":"/DNIAPI?command=SetLogServer&log_server_enable=true&log_server_port=6062&log_server_type=TCP"},
      {"command":"Reboot Device", "url":"/DNIAPI?command=RebootDevice&deviceIndex=1"},
      {"command":"Set Device Account and Password", "url":"/DNIAPI?command=SetDeviceAccountPassword&deviceIndex=1&account=admin&password=123456"}];

    var unitTest = new UnitTest();
    var cookie = {};

	function onLogin() {
      unitTest.Login(document.getElementById('ip').value, document.getElementById('port').value,
              document.getElementById('account').value, document.getElementById('password').value, LoginDone);
	}

    function LoginDone(str, hash) {
      var loginObj = JSON.parse(str);
      if (loginObj.errCode === 0) {
        // get cookie
        cookie.account = document.getElementById('account').value;
        cookie.hash = hash;

        console.log('Login ok, account : '+cookie.account+', hash : '+cookie.hash);
      } else {
        alert('Login Failed');
      }

      document.getElementById('response').value = str;
    }

    function onRequest() {
      unitTest.SendRequest(document.getElementById('ip').value, document.getElementById('port').value,
              document.getElementById('account').value, cookie.hash, document.getElementById('url').value,
              RequestCB);
    }

    function RequestCB(str) {
      var obj = JSON.parse(str);
      if (obj.errCode === 0) {
        console.log(str);
      } else {
        alert('Command : '+obj.command+' failed (error code : '+obj.errCode+')');
      }

      document.getElementById('response').value = str;
    }

    function onChangeCommand() {
      document.getElementById("url").value = httpAPI[document.getElementById("command").selectedIndex].url;
    }

  </script>

  <table align="center">
  <tr>
      <td>Server IP : </td>
	  <td><script>document.write('<input id="ip" type="text" value="192.168.1.200" size="16" style="width:150px;">');</script></td>
	  <td></td>
    </tr>

	<tr>
      <td>Server Port : </td>
	  <td><script>document.write('<input id="port" type="text" value="6060" size="16" style="width:50px;">');</script></td>
	  <td></td>
    </tr>

    <tr>
      <td>Account : </td>
	  <td><script>document.write('<input id="account" type="text" value="admin" size="16" style="width:150px;">');</script></td>
	  <td></td>
    </tr>

	<tr>
      <td>Password : </td>
	  <td><script>document.write('<input id="password" type="text" value="" size="16" style="width:150px;">');</script></td>
	  <td></td>
    </tr>

	<tr>
      <td><input id="Login" type="button" value="Login" style="width:100px;" onClick="onLogin()"></td>
	  <td><input id="SendRequest" type="button" value="Send Request" style="width:100px;" onClick="onRequest()"></td>
	  <td></td>
    </tr>

    <tr>
      <td>Command</td>
      <td><script>document.write('<select id="command" onchange="onChangeCommand()"></select>');</script></td>
      <td></td>
    </tr>

    <tr>
      <td>URL</td>
      <td><script>document.write('<textarea id="url" rows="5" cols="60"></textarea>');</script></td>
      <td></td>
    </tr>

    <tr>
      <td>Response</td>
      <td><script>document.write('<textarea id="response" rows="30" cols="60"></textarea>');</script></td>
      <td></td>
    </tr>
  </table>

<script>

  function ListCommand() {
    var command = document.getElementById("command");
    for (var i = 0; i < httpAPI.length; ++i) {
      var element = new Option(httpAPI[i].command, i);
      command.options.add(element);
    }

    document.getElementById("url").value = httpAPI[0].url;
  }

  ListCommand();
</script>
</body></html>
